<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"
        integrity="sha512-VEd+nq25CkR676O+pLBnDW09R7VQX9Mdiij052gVCp5yVH3jGtH70Ho/UUv4mJDsEdTvqRCFZg0NKGiojGnUCw=="
        crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.css"
      integrity="sha512-3pIirOrwegjM6erE5gPSwkUzO+3cTjpnV9lexlNZqvupR64iZBnOOTiiLPb9M36zpMScbmUNIcHUqKD47M719g=="
      crossorigin="anonymous"/>
<link rel="stylesheet" href="contact.css">

<script>
    // toastr custom settings
    (() => {
        toastr.options.closeButton = true;
        toastr.options.timeOut = 3000;
        toastr.options.extendedTimeOut = 3000;
        toastr.options.progressBar = true;

        toastr.options.showMethod = 'slideDown';
        toastr.options.hideMethod = 'slideUp';
        toastr.options.closeMethod = 'slideUp';
    })()

    // get form data
    // send it with fetch
    // idea: use toastr for showing the messages
    async function sendFormData() {
        const msgSuccess = "Email sent!"
        const msgError = "Something went wrong. Email not sent."

        // select the form element with dom api
        const formElement = document.getElementById("contact-form")

        // create FormData object and populate it with data from formElement
        // https://developer.mozilla.org/en-US/docs/Web/API/FormData/FormData
        const formData = new FormData(formElement)

        // create javascript object with key:value pairs representing form data
        const form = {}
        formData.forEach((value, key) => form[key] = value)

        // use fetch to post the form object to api
        await fetch("/api/contact", {
            headers: {
                "Content-Type": "application/json"
            },
            method: "POST",
            body: JSON.stringify(form)

        })
            // according to https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch
            // fetch will only reject promise if request is not completed or a network failure happens
            // this means http error codes like 404 will still result in a resolved promise
            // res.ok is set to true if http code is within 200-299 range.
            // So a 404 (or other error) will result in ok = false
            .then(res => {
                if (!res.ok) {
                    throw new Error(`Network response was not ok: ${res.status} ${res.statusText}`)
                }

                toastr.success(msgSuccess)
            })
            .catch(err => {
                toastr.error(msgError)
                console.log(err)
            })

        resetForm()
    }

    function resetForm() {
        document.getElementById("name").value = ""
        document.getElementById("email").value = ""
        document.getElementById("subject").value = ""
        document.getElementById("message").value = ""
    }
</script>

<div class="container">
    <div class="row justify-content-around">
        <div class="col text-center">
            <div class="text-center icon-container d-inline-block p-5">
                <a href="https://www.facebook.com/mads.christensen.790/">
                    <i class="fab fa-facebook"></i>
                </a>
            </div>
            <div class="text-center icon-container d-inline-block p-5">
                <a href="https://www.linkedin.com/in/mads-christensen-58b50013b/">
                    <i class="fab fa-linkedin"></i>
                </a>
            </div>
            <div class="text-center icon-container d-inline-block p-5">
                <a href="https://github.com/madskchristensen">
                    <i class="fab fa-github-square"></i>
                </a>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col d-flex justify-content-center text-center">
            <!-- Bruger action i stedet for onsubmit da onsubmit refresher siden,
    hvilket gÃ¸r at toastr notifikationen ikke bliver vist -->
            <form onsubmit="sendFormData(); return false;" id="contact-form">
                <div class="d-grid gap-1">
                    <div class="form-floating mb-3">
                        <input class="form-control" type="text" name="name" id="name" placeholder="Name" required>
                        <label for="name" class="form-label">Name</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input class="form-control" type="email" name="email" id="email" placeholder="Email" required>
                        <label for="email" class="form-label">Email: </label>
                    </div>
                    <div class="form-floating mb-3">
                        <input class="form-control" type="text" name="subject" id="subject" placeholder="Subject"
                               required>
                        <label for="subject" class="form-label">Subject: </label>
                    </div>
                </div>
                <div class="form-floating mb-3">
            <textarea class="form-control" name="message" id="message"
                      placeholder="Write something please..." required></textarea>
                    <label for="message" class="form-label">Message: </label>
                </div>

                <input type="submit" class="btn btn-primary" value="Send"/>
            </form>
        </div>
    </div>
</div>
